<div class="container-fluid card">
  <div class="card-gaming" *ngIf="categoryId === 1">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-gaming-hangouts" *ngIf="categoryId === 2">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-lore" *ngIf="categoryId === 3">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-lore-hangouts" *ngIf="categoryId === 4">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-announcements" *ngIf="categoryId === 5">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-vault" *ngIf="categoryId === 6">
    <div class="node-container">
      <div class="node-title-container">
        <div class="card-title">
          <div class="title" *ngFor="let category of categories; let i = index">
            <a *ngIf="i === categoryId - 1" class="light-link"><h3 class="subject">{{ category.name }}</h3></a>
          </div>
          <div class="description" *ngFor="let category of categories; let i = index">
            <p *ngIf="i === categoryId - 1" class="cat-description">{{ category.description }}</p>
          </div>
          <div class="meta-details">

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="breadcrumb-outer">
  <div class="breadcrumb-inner">
    <ol class="breadcrumbnav" style="padding:0;">
      <li class="breadcrumb-value" [routerLink]="['/home']">Discussion</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 1">Gaming Forum</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 2">Gaming Hangouts</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 3">Lore Forum</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 4">Lore Hangouts</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 5">Announcements</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 6">The Vault</li>
    </ol>
  </div>
</div>

<div class="wrapper">

<div class="mat-paginator-container" fxLayout="row" fxLayoutAlign="center center">
  <button mat-icon-button [disabled]="currentPage === 1" (click)="goToPreviousPage()">
    <mat-icon>keyboard_arrow_left</mat-icon>
  </button>
  <div class="mat-paginator-range-label">
    Page {{ currentPage }} of {{ getTotalPages() }}
  </div>
  <button mat-icon-button [disabled]="currentPage === getTotalPages()" (click)="goToNextPage()">
    <mat-icon>keyboard_arrow_right</mat-icon>
  </button>
</div>

<div class="block-filter-bar">
  <div class="filter-bar" style="height: 25px;">
    <button class="filter-bar-menu-trigger" mat-button [matMenuTriggerFor]="menu" style="display: flex; align-items: center;">
      <span style="flex-grow: 1;">Filters</span>
      <span class="filter-bar-icon" style="margin-left: 5px;"><mat-icon style="vertical-align: top; margin-left:-10px;">arrow_drop_down</mat-icon></span>
    </button>
  </div>
</div>
<ng-container *ngIf="(pinnedPosts$ | async)?.length && this.currentPage === 1">
<div class="pinned-main-container">
  <div class="pinned-container" *ngFor="let post of (pinnedPosts$ | async); let i = index">
    <article class="pinned-message-outer">
        <span class="anchorTarget"></span>
        <div class="message-inner">
          <div class="message-cell message-cell-user">
            <section class="message-user">
              <div class="message-avatar">
                <div class="message-avatar-wrapper">
                  <a [routerLink]="['/users', post.user.id]">
                    <img class="user-avatar" [style.background-image]="'url(' + post.user.imageUrl + ')'" [style.background-position]="'center'">
                  </a>
                </div>
              </div>
              <div class="user-details-wrapper">
                <div class="userDetails"></div>
                <div class="userExtras"></div>
              </div>
            </section>
          </div>
          <div class="message-cell message-cell-main">
            <div class="message-main">
              <div class="message-content">
                <a class="post-link" [routerLink]="['/categories', categoryId, 'posts', post.id, 'comments']" [innerHtml]='post.subject'>{{ post.subject }}</a>
                <!-- This is a placeholder for click event on post in above anchor tag:  (click)="incrementViewCount(this.categoryId, post.id)" -->
              </div>
              <div class="message-content-details">
                <div class="message-user-details">
                  <div>
                    <a class="post-link" [routerLink]="['/users', post.user.id]"><p class="p-content">{{ post.user.username }}</p></a>
                  </div>
                  <div>
                    <p class="p-content"><span style="margin-left: 5px; margin-right: 5px;">&#183;</span> {{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</p>
                  </div>
                </div>
                <div class="message-metadetails">
                  <mat-icon *ngIf="post.isTrending">trending_up</mat-icon>
                  <mat-icon id="trending-icon" *ngIf="post.isPinned">push_pin</mat-icon>
                  <div class="view-count">
                    <mat-icon class="mat-icons">visibility</mat-icon>
                    <p class="p-content">{{ post.viewCount }}</p>
                  </div>
                  <div class="comment-count">
                    <mat-icon class="mat-icons" style="margin-left: 8px;">chat_bubble</mat-icon>
                    <p class="p-content">{{ post.comments.length + 1}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="latest-comment-details" *ngFor="let comment of post.comments; let i = index;">
            <div *ngIf="i === post.comments.length - 1 && post.comments.length >= 1" class="latest-comment-date">{{ comment.createdAt | date:'shortDate' }} at {{ comment.createdAt | date:'shortTime' }}</div>
            <div *ngIf="i === post.comments.length - 1 && post.comments.length >= 1" class="latest-comment-user" [routerLink]="['/users', comment.user.id]">{{ comment.user.username }}</div>
            <div *ngIf="post.comments.length < 1" class="latest-comment-date">{{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</div>
            <div *ngIf="post.comments.length < 1" class="latest-comment-date">{{ post.user.username }}</div>
          </div>
          <div class="latest-comment-details" *ngIf="post.comments.length < 1">
            <div class="latest-comment-date">{{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</div>
            <div class="latest-comment-date" [routerLink]="['/users', post.user.id]">{{ post.user.username }}</div>
          </div>
        </div>
      </article>
  </div>
</div>
</ng-container>
    <div class="article-container" *ngFor="let post of (posts$ | async)?.slice((currentPage - 1) * 10, currentPage * 10); let i = index">
      <article class="message-outer" *ngIf="!post.isPinned">
        <span class="anchorTarget"></span>
        <div class="message-inner">
          <div class="message-cell message-cell-user">
            <section class="message-user">
              <div class="message-avatar">
                <div class="message-avatar-wrapper">
                  <a [routerLink]="['/users', post.user.id]">
                    <img class="user-avatar" [style.background-image]="'url(' + post.user.imageUrl + ')'" [style.background-position]="'center'">
                  </a>
                </div>
              </div>
              <div class="user-details-wrapper">
                <div class="userDetails"></div>
                <div class="userExtras"></div>
              </div>
            </section>
          </div>
          <div class="message-cell message-cell-main">
            <div class="message-main">
              <div class="message-content">
                <a class="post-link" [routerLink]="['/categories', categoryId, 'posts', post.id, 'comments']" [innerHtml]='post.subject'>{{ post.subject }}</a>
                <!-- This is a placeholder for click event on post in above anchor tag:  (click)="incrementViewCount(this.categoryId, post.id)" -->
              </div>
              <div class="message-content-details">
                <div class="message-user-details">
                  <div>
                    <a class="post-link" [routerLink]="['/users', post.user.id]"><p class="p-content">{{ post.user.username }}</p></a>
                  </div>
                  <div>
                    <p class="p-content"><span style="margin-left: 5px; margin-right: 5px;">&#183;</span> {{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</p>
                  </div>
                </div>
                <div class="message-metadetails">
                  <mat-icon *ngIf="post.isTrending">trending_up</mat-icon>
                  <div class="view-count">
                    <mat-icon class="mat-icons">visibility</mat-icon>
                    <p class="p-content">{{ post.viewCount }}</p>
                  </div>
                  <div class="comment-count">
                    <mat-icon class="mat-icons" style="margin-left: 8px;">chat_bubble</mat-icon>
                    <p class="p-content">{{ post.comments.length + 1}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="latest-comment-details" *ngFor="let comment of post.comments; let i = index;">
            <div *ngIf="i === post.comments.length - 1 && post.comments.length >= 1" class="latest-comment-date">{{ comment.createdAt | date:'shortDate' }} at {{ comment.createdAt | date:'shortTime' }}</div>
            <div style="cursor: pointer;" *ngIf="i === post.comments.length - 1 && post.comments.length >= 1" class="latest-comment-user" [routerLink]="['/users', post.user.id]">{{ comment.user.username }}</div>
            <div *ngIf="post.comments.length < 1" class="latest-comment-date">{{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</div>
            <div *ngIf="post.comments.length < 1" class="latest-comment-date" [routerLink]="['/users', post.user.id]">{{ post.user.username }}</div>
          </div>
          <div class="latest-comment-details" *ngIf="post.comments.length < 1">
            <div class="latest-comment-date">{{ post.createdAt | date:'shortDate' }} at {{ post.createdAt | date:'shortTime' }}</div>
            <div class="latest-comment-date" [routerLink]="['/users', post.user.id]">{{ post.user.username }}</div>
          </div>
        </div>
      </article>
    </div>

  </div>



<div *ngIf="loggedIn()" class="post-block">
  <div class="post-block-inner">
    <div class="user-block-outer">
      <div class="user-block">
        <div class="user-block-inner">
          <div class="user-avatar-container">
            <a style="cursor: pointer;" [routerLink]="['/users', loggedInUser.id]"><img class="my-avatar" [style.background-image]="'url(' + loggedInUser.imageUrl + ')'" [style.background-position]="'center'" *ngIf="loggedIn()"/></a>
          </div>
          <div class="user-alias">
            <a class="user-name-text" *ngIf="loggedIn()" [routerLink]="['/users', loggedInUser.id]">{{ loggedInUser.username }}</a>
          </div>
        </div>
      </div>
    </div>
    <div class="editor-outer" style="padding: 10px;">
      <div class="editor-inner" style="padding: 10px;">
          <mat-label style="font-weight: bolder; margin-right: 10px; color: var(--text-color);">Title:</mat-label>
          <input mat-input [formControl]="subject" [(ngModel)]="newPost.subject" required>
          <mat-error *ngIf="subject.invalid && checkCkEditor">{{ getErrorMessageSubject() }}</mat-error>
      </div>
      <div class="editor-inner" style="padding: 10px;">
          <ckeditor #ckeditorInstance name="newPost.content" [editor]="Editor" [config]="{placeholder: 'Hello, Colonel! This is Snake.', contentsCSS: ['src/app/shared/components/posts/posts.component.css']}" [formControl]="content" [(ngModel)]="newPost.content" required></ckeditor>
          <mat-error *ngIf="content.invalid && checkCkEditor">{{ getErrorMessageContent() }}</mat-error>
      </div>
      <div class="submitButtonContainer" style="float: right; padding-right: 10px;">
        <button class="submitBtn" mat-stroked-button (click)="submitButtonClicked();">Submit</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!loggedIn()" style="display: flex; justify-content: center;">
  <p class="login-prompt">Log in to post!</p>
</div>


<div class="breadcrumb-outer-bottom">
  <div class="breadcrumb-inner">
    <ol class="breadcrumbnav" style="padding:0;">
      <li class="breadcrumb-value" [routerLink]="['/home']">Discussion</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 1">Gaming Forum</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 2">Gaming Hangouts</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 3">Lore Forum</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 4">Lore Hangouts</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 5">Announcements</li>
      <li class="breadcrumb-value" *ngIf="categoryId === 6">The Vault</li>
    </ol>
  </div>
</div>

<ng-template #filterDialog>
  <div mat-dialog-content>
    <input [(ngModel)]="filterSubject" (input)="filterPosts()" size="15" placeholder="Filter by subject" style="line-height: 2px;">
  </div>
</ng-template>

<mat-menu #menu="matMenu">
  <ng-container *ngIf="currentPage === 1">
      <mat-form-field class="my-form-field" style="padding:10px;">
        <input matInput [(ngModel)]="filterSubject" (input)="filterPosts()" (click)="$event.stopPropagation()" placeholder="Filter by subject">
      </mat-form-field>
  </ng-container>
</mat-menu>



